%%%%clear all possible previous dataclear%%%%load camara trap data files load 'Months.txt'load 'Data.txt'load 'Datacamera.txt'%%%%specific data for the study example. Modify the values for your own study%total camera trap stationsns=12;%total speciesne=13;%initial year of studyiy=2023;%final year of studyfy=2023;%%%%three dimensional matrix constructionG=[];td=sum(Months);Matriz2=zeros(td,ns,ne);day=1;for i=iy:1:fy  for j=1:1:12    for k=1:1:Months(j,1)      g=find(Data(:,5)==i&Data(:,4)==j& Data(:,3)==k);       if rows(g)~=0        for m=1:1:rows(g)          x=g(m,1);          est=Data(x,1);          esp=Data(x,2);          G=[G;est,esp,day];          Matriz2(day,est,esp)=Matriz2(day,est,esp)+1;        endfor       end  day=day+1;    endfor   endforendfor%%%%looking for same day coincidencesMatriz=sign(Matriz2);E=zeros(ne,ne);for i=1:1:ne  for j=i:1:ne    D=sign(Matriz(:,:,i))+sign(Matriz(:,:,j));    E(i,j)=rows(find(D==2));    E(j,i)=rows(find(D==2));  endforendforfor pr=1:1:ne  E(pr,pr)=0;endforsave desfase0dias.txt E%%%%Searching for coincidences in time intervals of up to 20 days after the passage of a speciesfor m=1:1:20  E=zeros(ne,ne);    for i=1:1:ne      for j=1:1:ne        D=sign(Matriz(1:td-m,:,i))+sign(Matriz(m+1:td,:,j));        E(i,j)=rows(find(D==2));      endfor    endfor        for pr=1:1:ne      E(pr,pr)=0;    endforfile_name=strcat('desfase',num2str(m),'dias.txt');   save nombre E;rename ('nombre', [file_name])endfor%%%%calculate the frequency for each camera trap stationFrec=[];for i=1:1:ne  for j=1:1:ns  Frec(i,j)=sum(sum(Matriz(:,j,i)));  endforendforsave Frec Frec%%%%calculate total days per camera trap stationsfechas=[];for k=1:1:rows(Datacamera)  r=Datacamera(k,4)-iy;  diai=sum(Months(1:12*r+Datacamera(k,3)-1,1))+Datacamera(k,2);  r=Datacamera(k,7)-iy;  diaf=sum(Months(1:12*r+Datacamera(k,6)-1,1))+Datacamera(k,5);  fechas=[fechas;diai,diaf,diaf-diai+1];endforsave fechas fechas%%%%calculate coincidences between species pairs taking into account different delays in daysR2=[];F=[];for k=0:1:20  file_name=strcat('desfase',num2str(k),'dias.txt');  load (file_name);  F(:,:,k+1)=E;endforfor i=1:1:ne  for j=1:1:ne    vec=[];      for m=1:1:21        vec=[vec,F(i,j,m)];      endfor    R2=[R2;i,j,vec];endforendforsave R2A.txt R2 %%%%IAR calculationIAR=[];for j=1:1:rows(fechas)  if(fechas(j,3)==1)    fechas(j,3)=0;  endifendforfor i=1:1:rows(Frec)  IAR=[IAR;(sum(Frec')(1,i)/sum(fechas)(:,3))*100];endforsave IAR2 IAR%%%%bootstrap processfor h=1:1:10  for y=1:1:100    %initializing variables    Matriz4=zeros(td,ns,ne);    i=1;      while  i<sum(sum(sum(Matriz)))      %station random generation      w=ceil(rand(1,1)*columns(Matriz));      %day random generation       dia=floor(fechas(w,1)+rand(1,1)*(fechas(w,3)));      %specie random generation      especie=floor(rand(1,1)*(ne+1));      %we only use this generated data if frequency in station allow it         if  w~=0 && especie~=0         if  sum(sum(Matriz4(:,w,especie)))<Frec(especie,w)           Matriz4(dia,w,especie)=1;          i=sum(sum(sum(Matriz4)));        end      end    endwhile    save Matriz4.txt Matriz4    %once generated a bootstrap we find the list of coincidences    E=zeros(ne,ne);    for i=1:1:ne      for j=i:1:ne        D=sign(Matriz4(:,:,i))+sign(Matriz4(:,:,j));        E(i,j)=rows(find(D==2));        E(j,i)=rows(find(D==2));      endfor    endfor    for pr=1:1:ne      E(pr,pr)=0;    endfor    save desfase0dias.txt E    %Searching for coincidences in time intervals of up to 20 days after the passage of a species    for m=1:1:20      E=zeros(ne,ne);      for i=1:1:ne        for j=1:1:ne          D=sign(Matriz4(1:td-m,:,i))+sign(Matriz4(m+1:td,:,j));          E(i,j)=rows(find(D==2));        endfor      endfor          for pr=1:1:ne       E(pr,pr)=0;      endfor      file_name=strcat('desfase',num2str(m),'dias.txt');         save nombre E;      rename ('nombre', [file_name])    endfor    %random landscape coincidence list    R4=[];    F=[];    for k=0:1:20      file_name=strcat('desfase',num2str(k),'dias.txt');      load (file_name);      F(:,:,k+1)=E;    endfor    for i=1:1:ne      for j=1:1:ne        vec=[];          for m=1:1:21            vec=[vec,F(i,j,m)];          endfor        R4=[R4;i,j,vec];      endfor    endfor    file_name=strcat('Todob',num2str(y),'.txt');       save nombre R4    rename ('nombre', [file_name])  endfor    MT=[];      for k=1:1:100  file_name=strcat('Todob',num2str(k),'.txt');  load (file_name);  MT(:,:,k)=R4;  endfor  %empirical p-value calculation    MTpasa=[];  MTpasap=[];  for j=1:1:rows(R2)    for m=1:1:columns(R2)      MTpasap(j,m)=(1+sum(MT(j,m,:)>=R2(j,m)))/101;    endfor  endfor  MTpasa=(MTpasap<0.05);  MTpasa=[R2(:,1:2),MTpasa(:,3:23)]  MTpasap=[R2(:,1:2),MTpasap(:,3:23)]  LIs=[]  for t=1:1:rows(MTpasap)      r=sum(MTpasa(t,3:23))    if r~=0      g=find(MTpasa(t,3:23)==1)      LIs=[LIs;MTpasa(t,1),MTpasa(t,2),g(1,1),MTpasap(t,g(1,1)+2),r];    end  endfor   file_name=strcat('analisis2B',num2str(h),'.txt');       save nombre MTpasa LIs MTpasap    rename ('nombre', [file_name])  endfor%%%%Analyze 10 executions of 100 events each.clearMTT=[];for k=1:1:10  file_name=strcat('analisis2B',num2str(k),'.txt');  load (file_name);MTT(:,:,k)=MTpasap;endfor%proportionMedias=[];Varianzas=[];Apariciones=[];for j=1:1:rows(MTT)  for m=1:1:columns(MTT)       Medias(j,m)=mean(MTT(j,m,:));       Varianzas(j,m)=var(MTT(j,m,:));       Apariciones(j,m)=rows(find(MTT(j,m,:)<0.05))/10;  endforendforMedias2=(Medias(:,3:23)<0.05);Medias2=[Medias(:,1:2),Medias2];Apariciones(:,1:2)=Medias(:,1:2);LIs=[];for t=1:1:rows(MTpasap)  g=find(Medias(t,3:23)<0.05);    if columns(g)~=0    LIs=[LIs;MTpasap(t,1),MTpasap(t,2),g(1,1),Medias(t,g(1,1)+2),Varianzas(t,g(1,1)+2),Apariciones(t,g(1,1)+2)];    endendforLIs2=[];for t=1:1:rows(MTpasap)  r=sum(Medias(t,3:23));    if r~=0      g=find(Apariciones(t,3:23)==1);      if columns(g)~=0        LIs2=[LIs2;MTpasap(t,1),MTpasap(t,2),g(1,1),Medias(t,g(1,1)+2),Varianzas(t,g(1,1)+2)];      end    endendforsave analisis2B.txt LIs LIs2 Medias2 Medias Varianzas Apariciones%%%%Saving directed edges of the Coocurrence networksave network.txt LIs2